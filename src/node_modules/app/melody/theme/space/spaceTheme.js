import spaceDefaults        from 'evoke-me/space/api/spaceDefaults'

import config               from '../api/config'
import orderTypeMap         from '../api/orderTypeMap'
import queryRecommend       from '../api/rest/queryRecommend'


export default [
  config.namespace,
  config.entity,
  [],
  () => ({
    ...spaceDefaults.state,
  }),
  {
    ...spaceDefaults.updaters,

    queryRecommend: (setState, getState, { create, orderClear }) => function* () {
      try {
        yield setState({ isLoading: true })

        const { result, errors } = yield queryRecommend()

        if (errors.length) {
          return yield setState({ errors, isLoading: false })
        }

        yield orderClear(orderTypeMap.RECOMMEND)
        for (let doc of result) {
          yield create(doc, { orderName: orderTypeMap.RECOMMEND })
        }

        yield setState({ isLoading: false })
      } catch (err) {
        yield setState({ isLoading: false })

        console.error(err)
      }
    },
  }
]
