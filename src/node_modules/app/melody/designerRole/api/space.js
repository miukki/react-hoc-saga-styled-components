import spaceDefaults        from 'evoke-me/space/api/spaceDefaults'

import config               from './config'
import query                from './rest/client/query'


export default [
  config.namespace,
  config.entity,
  [],
  () => ({
    ...spaceDefaults.state,
  }),
  {
    ...spaceDefaults.updaters,

    query: (setState, getState, { create }) => function* () {
      try {
        yield setState({ isLoading: true })

        const { result, errors } = yield query()

        if (errors.length) {
          return yield setState({ errors, isLoading: false })
        }

        for (let doc of result) {
          yield create(doc)
        }

        yield setState({ isLoading: false })
      } catch (err) {
        yield setState({ isLoading: false })

        console.error(err)
      }
    },
  }
]
