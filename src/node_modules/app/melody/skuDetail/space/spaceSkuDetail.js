import spaceDefaults        from 'evoke-me/space/api/spaceDefaults'

import config               from '../api/config'
import queryBySkuNo         from '../api/rest/queryBySkuNo'


const __type = config.entity

export default [
  config.namespace,
  config.entity,
  [],
  () => ({
    ...spaceDefaults.state,
  }),
  {
    ...spaceDefaults.updaters,

    queryBySkuNo: (setState, getState, { create }) => function* (payload) {
      try {
        const {
          skuNo
        } = payload

        yield setState({ isLoading: true })

        const { result, errors } = yield queryBySkuNo({ skuNo })

        if (errors.length) {
          return yield setState({ errors, isLoading: false })
        }

        yield create({
          ...result,
          skuId: result.id,
          id: `${__type}${result.id}`,
          __type: `skuDetail`,
        })

        yield setState({ isLoading: false })
      } catch (err) {
        yield setState({ isLoading: false })

        console.error(err)
      }
    },
  }
]
